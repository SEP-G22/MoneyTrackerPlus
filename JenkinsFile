pipeline {
    agent any  // 允許在任何可用的 Jenkins 節點執行
    stages {
        stage('Build & Prepare') {
            steps {
                script {
                    echo "Current working dir: ${pwd()}"
                    echo "Building the project..."
                    bat '''
                        chcp 65001 >nul
                        cd src
                        pyinstaller --onefile --windowed main.py
                    '''
                }
            }
        }
        stage('Run Testcases 4-01 to 4-10') {
            steps {
                script {
                    for (int i = 1; i <= 10; i++) {
                        def testName = String.format("Testcase4-%02d", i)
                        echo "Running ${testName}..."

                        def result = bat(script: """
                            cd src\\dist
                            start main.exe
                            ..\\..\\Robotiive_runner.exe Final ${testName}
                        """, returnStatus: true)

                        if (result != 0) {
                            error("${testName} Failed!") // Jenkins UI 顯示哪個 testcase 失敗
                        }
                    }
                }
            }
        }
    }
}