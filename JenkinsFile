def tests = (1..10).collect { String.format("Testcase4-%02d", it) }
pipeline {
    agent any  // 允許在任何可用的 Jenkins 節點執行
    stages {
        stage('Build & Prepare') {
            steps {
                script {
                    echo "Current working dir: ${pwd()}"
                    echo "Building the project..."
                    bat '''
                        chcp 65001 >nul
                        cd src
                        pyinstaller --onefile --windowed main.py
                    '''
                }
            }
        }
        stages {
            script {
                tests.each { testName ->
                    stage("Run ${testName}") {
                        steps {
                            script {
                                echo "Running ${testName}..."
                                def result = bat(script: """
                                    cd src\\dist
                                    start main.exe
                                    ..\\..\\Robotiive_runner.exe Final ${testName}
                                """, returnStatus: true)

                                if (result != 0) {
                                    error("${testName} Failed!")
                                }
                            }
                        }
                    }
                }
            }
        }
    }
}